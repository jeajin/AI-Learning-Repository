1. T1DMS 타입 1 당뇨병 대사 시뮬레이터 시작

1.1. 전제 조건  
     지원되는 운영 체제: T1DMS에서 Windows 10 지원
     Simulink™ 및 Curve Fitting Toolbox가 탑재된 Matlab™ 버전 최대 2020a(V9.8.0)(32비트 또는 64비트)  
     선택 사항: 병렬 컴퓨팅 도구 상자를 설치하고 병렬 프로세싱(64비트)을 위해 matlabpool 또는 parpool을 사     용하십시오.

1.2. 설치 프로세스

	1. 모델 폴더를 저장하고 소프트웨어를 활성화하려면 'T1DMS 설치 안내서'의 지침을 따르십시오.

	2. 활성화 후 시뮬레이터 모델 폴더의 복사본을 하드 드라이브에 복사할 수 있다.

	   시뮬레이터 모델 폴더의 사본을 두 개 이상 유지할 수 있다.

	   나중에 사용할 수 있도록 라이센스 관리자 및 활성화 코드에 대한 액세스 권한을 유지하십시오.

1.3. 시뮬레이터 작동

	1. 맷랩 시작. 시뮬레이터 폴더가 Matlab의 "현재 폴더"로 선택되었는지 확인하십시오.

	2. Matlab 명령줄에 Simulator를 입력하십시오(명령어는 대소문자를 구분함).
	   아래 화면이 나타날 것이다.

그림 1: 기본 GUI 창



볼루스 : 약이나 식사의 한 회분

 
2. 시나리오 만들기

	2.1. ASCII 시나리오 파일 사용
	   시뮬레이션 시간, 초기 조건, 식사 및 개방형 루프 처리 매개변수는 ASCII 텍스트 형식으로 시나리오 	   	파일에 저장된다.

               T1DMS 응용 프로그램이 시나리오 파일을 인식하고 로드하려면 .scn 확장자가 있어야 하며 시뮬레이	 	  터 폴더 내의 시나리오 폴더에 배치되어야 한다.
     
	   시뮬레이터는 특정 ASCII 파일 마커(아래 나열)를 사용하여 시나리오 데이터를 로드하고 처리를 위해 	 	  Matlab으로 전송한다.

	   사용 가능한 시나리오 목록에서 선택하려면 Select Scenario Files 버튼을 클릭하십시오.

	   입력 정보로 인식되는 행의 첫 번째 문자로 백분율 기호(%)를 사용한다.


ASCII FileMarker        
Definition 


Tsimul 
시뮬레이션 길이

QTsimul
Tsimul의 단위(분, 시간 또는 일)

Tclosed 
폐쇄 루프 시작

QTclosed 
폐쇄 단위(QT시뮬 참조)

Treg 
규정 시작(시뮬레이션 시작 후 분 단위)

simToD 
시뮬레이션 시작 시 하루의 시간(자정로부터 분 단위)

BGinit
사용자가 초기 혈당(mg/dl)을 양의 값으로 설정할 수 있다. 
지정되지 않은 경우 시뮬레이션은 각 피사체의 단식 상태에서 시작한다.
인간 포도당 변동의 범위 내에 있는 현실적인 초기 포도당 값을 사용하는 것이 좋다.


Note 
초기 포도당 변화율은 항상 0이다.

Tmeals
식사 시간의 벡터
(시뮬레이션 시작 시부터 시간이 시작됨;
식사 사이에 최소 60분을 기록한다;
시뮬레이션 시작 후 최소 60분 후 첫 식사).

Ameals
식사의 총량 또는 kg당 그램의 벡터

Dmeals 
식사의 지속시간 벡터(분)(Dmals가 지정되지 않은 경우, 기본값)
값=15분). 단일 값(모든 식사가 동일) 또는 동일한 벡터 입력            
각 식사의 기간을 지정하여 식사로 크기 조정 (주: 최대 30개)
분식시간)

QTmeals 
Tmeal 단위(분, 시간 또는 일)

Qmeals 
식사량 단위; 평균을 총(총) 금액(그램) 또는 다음으로 지정
그램/kg 체중(kg당)

basal 
개방 루프 중 기본 인슐린 주입
(모든 피험자에 대해 고정됨, 단위/시간).
환자별 기본 주입은 Qbasal 참조)

Qbasal 
이 탭은 사용자가 인슐린의 기본 비율을 특정 과목으로 설정할 수 있도록 한다.
'Qbasal'을 퀘스트로 설정하면 오픈 루프 기준 비율이 대상별로 지정되며 대상의 단식 수준을 유지하는 데 필요한 기본 비율에 해당된다.
('일반'에 정의된 바와 같이, 섹션 6.3.1 참조).
다른 값은 무시된다. 
‘Qbasal’은 ‘basal’에 포함된 모든 정보를 대체한다.

OB 
최적 볼루스를 ON으로 설정하면, OB 값은 식사량 함수로 식사량을 계산하는 데 사용된다.
(예: 대상자의 탄수화물 비율인 경우, CR=15 => OB=0.0667 =>1U).
OB는 주제별로 다르며 '질문'의 일부분이다 섹션 6.3.1 참조 
다른 모든 값은 off와 같다. 
참고: OB와 Ablus가 모두 설정된 경우 사용자에게 하나를 선택하라는 창이 열린다.


Tbolus 
개방 루프 중 인슐린 조영제 주입 시간

QTbolus 
Tbolus 단위(분, 시간 또는 일)

Abolus 
개방 루프 중 인슐린 단위 내 볼루스의 양
(시뮬레이션에 사용되는 모든 주제에 대해 고정됨, 환자별 볼루스는 OB 참조)


TIVINS
연속 IV 인슐린 주사 시작 시간 및 종료 시간의 벡터(시뮬라티오 시작 후 분)


QIVINS 
무게(kg) 또는 총(총) kg 당 IV 인슐린 주입 용량


AIVINS 
TIBNS와 일치하는 IV 인슐린 주사 벡터
(분당 인슐린 U)


TIVD 
연속 IV 덱스트로스 주입의 시작 시간과 종료 시간의 벡터

QIVD 
체중(perkg) 또는 총(총) kg 당 IV 덱스트로스 주입 용량

AIVD 
TIBD와 일치하는 IV 덱스트로스 주사 벡터
(CHO의 그램)


2.2. 시나리오 파일의 예

아래 표시된 샘플 파일은 BGinit이 지정되지 않은 시나리오(단식), 2일 개방 루프,
그리고 2일간 폐쇄 루프.


simulation info 

%Tsimul=4 
%QTsimul=day    //시뮬레이션의 길이가 4일
%simToD=0     //시뮬레이션 시작 시 하루의 시간(자정로부터 분 단위)

closed loop info 

%Tclosed=48     //폐쇄루프 시작
%QTclosed=hour      // 폐쇄 루프의 단위가 1시간
%Treg=2880        //규정시작
meals info   
%Tmeals=[7 12 18 22 31 36 42 46 55 60 66 70 79 84 90 94] 
%QTmeals=hour 
%Ameals=[45 70 80 20 45 70 80 20 45 70 80 20 45 70 80 20] 
%Dmeals=[15] 
%Qmeals=total 
Open loop insulin info 
%Qbasal=quest 
%OB=o

그림 2: 시나리오 파일 예


2.2.1. '시뮬레이션 시간' vs '폐쇄 루프 시작' vs '규정 시작'

시나리오의 일부로 정의되는 세 가지 중요한 시간이 있다.


1. 시뮬레이션 시간 - 시뮬레이션을 실행하는 시간을 확인한다.  

2. 폐쇄 루프 시작 - 개방 루프 시나리오가 아닌 컨트롤러에 의해 인슐린 주사를 관리하는 시간.
		 폐쇄 루프 시작 후 발생하는 것으로 정의된 모든 (개방 루프 중 기본 인슐린 주입) 또는  한 회		 분(볼루스)들은 무시된다.
		 폐쇄 루프 제어를 피하려면 시뮬레이션 시간보다 크거나 같은 시간을 선택하십시오.

3. Treg - 규정의 시작(또는 위임의 종료).
	폐쇄 루프 시작과 규정 시작 사이의 시간, 즉 커밋 기간은 컨트롤러의 워밍업 시간을 나타낸다.
	이는 폐루프의 시작보다 규정 시간을 늦게 설정하여 필요할 경우 성능평가에서 제외할 수 있다.
	이후 시간은 결과 측정이 계산되는 기간을 제어한다.

2.3. 시나리오 파일 선택
	시나리오 폴더에 저장된 시나리오 파일은 시뮬레이터 창에서 시나리오 파일 선택 버튼을 클릭하여 액세		스할 수 있다.
	사용 가능한 시나리오 창에서 원하는 시나리오를 찾아 클릭하여 선택한 다음 화살표 버튼을 클릭하여 		선택한 시나리오 창으로 이동하십시오.
	기본 창으로 돌아가기 버튼을 클릭하여 시나리오 선택 창을 닫으십시오.

2.4. GUI를 사용하여 시나리오 작성
	GUI를 사용하여 시나리오 생성 버튼을 통해 사용할 수 있는 사용자 정의 가능한 사전 로드 시나리오를 		사용하여 시나리오를 생성하여 샘플을 시뮬레이션할 수 있다.

	-1끼
	-1일 3끼와 2끼 간식으로
	-1주일간 7일 동일

	사용자 정의된 시나리오가 활성화되면(시나리오 생성 버튼을 클릭하여) 이전에 정의된 시나리오(로드되		거나 사전 로드됨)가 비활성화된다는 점에 유의하십시오.
	비활성화되면 시뮬레이션 길이나 식사 시간 등 이전의 모든 정보가 지워지고 새로운 시나리오로 대체된다.
	시뮬레이터에 로드된 모든 시나리오 정보를 제거하려면 Clear Scenario 버튼을 클릭하십시오.
	시나리오를 사용자 정의한 후에는 .scn 파일로 저장 버튼을 클릭하여 .scn 파일로 저장할 수 있다.

	저장된 시나리오는 시나리오 폴더에 저장되며 사용 가능한 다른 시나리오 파일과 동일한 방식으로 검색할 	수 있다(시나리오 생성 버튼을 누르기 전에 시나리오 저장)


2.4.1. 시뮬레이션 파라미터
사용자 지정 가능한 모든 사전 로드 시나리오의 경우 다음을 포함하는 시뮬레이션 파라미터를 입력하십시오.
시뮬레이션 시간(하루=1440분), 폐쇄 루프 제어 시간의 시작, 제어 예열 시간 및 초기 혈당
(초기혈당: 대상별 단식 BG를 위해 비워두다.)
	 
	이러한 매개변수는 '시뮬레이션 매개변수' 섹션의 창 상단에 입력된다.

2.4.2. CSII 매개변수
CSII 파라미터 섹션에서는 인슐린 펌프에서 연속 피하 인슐린 주입(CSII) 투여량을 구성할 수 있다.
CSII 매개변수를 구성하기 위한 두 가지 대안이 있다 :
	1. 주제별 매개변수 - 피험자의 특정 기준 및 피험자의 특정 CHO/I 비율(탄수화물당 인슐린 비율)에 대한 			라디오 버튼을 선택할 때, 기본 비율은 피험자별 최적 비율로 설정되고 식사 한회분은 			최적의 탄수화물 대 인슐린 비율을 사용하여 계산된다.
	2. 고정 매 개변수 - Fixed open roop basal [U/hr] 및 Fixed bolus에 대한 라디오 버튼을 선택하면 open 				roop 시뮬레이션 중에 기본 인슐린 투여랑 및 약의 한회분에 대해 당신이 지정한 값이 			모든 선택된 피사체에 적용된다.

<실제 창의 목록 4가지>
피험자의 구체적인 기본 인슐린 주입.
고정된 개방 루프 기본 인슐린 주입[U/hr]

피험자의 특정 CHO/I 비율
고정된 볼루스(약의 한 회분)      (아래 섹션에 입력)


중요 참고 : 복수의 식사를 시뮬레이션하려면, CSII 파라미터를 설정하기 전에 반드시 복수 식사 섹션 옆에 있는 상자	  를 체크해야 한다.


2.4.3. 단일 식사
1회의 식사 시나리오는 그램 단위의 식사 탄수화물 양, 분 단위의 식사 시간, 분 단위의 식사 지속 시간, 인슐린 단위에서의 관련 볼루스의 양 등 4가지 매개변수를 가지고 있다.
단일 식사 시나리오를 활성화하려면 단일 식사 섹션 옆에 있는 상자를 선택하십시오.

참고: 시나리오의 개방 루프 섹션에 관련된 모든 볼루스(약의 한 회분)와 기본 파라미터. 닫힌 루프 단계(볼러스의 타이밍이 닫힌 루프 단계의 시작 시간보다 큼) 중에 볼러스가 프로그래밍된 경우, 볼러스는 무시된다.

<실제 창의 목록>
탄수화물의 양 입력,   타이밍[분]

인슐린 하루회분량 입력,   지속시간[분]


2.4.4. 복수 식사
복수 식사 섹션에서는 원하는 라디오 버튼을 선택하여 하루 시나리오 또는 일주일 시나리오를 생성할 수 있다.
두 옵션 모두 동일한 구조를 따른다;1주일 시나리오는 하루 시나리오를 7번 반복한다.

다중 식사 시나리오는 10가지 매개변수로 구성되어 있다: 5가지 잠재적 식사(아침, 점심, 저녁, 2가지 간식)에 대한 탄수화물 그램. 인슐린 단위에서의 결합도.
식사의 타이밍은 고정되고 시뮬레이션의 길이는 자동으로 24시간으로 설정된다.
24시간 시뮬레이션 길이는 시뮬레이션 매개변수 섹션에 입력된 길이를 대체한다(위 참조).
단일 식사 시나리오와 마찬가지로, 폐쇄 루프 단계에서는 대기와 기저률이 무시된다.



3. 과목 선택
Select Subject(Subject) 섹션(그림 1: 메인 GUI 창에 표시됨)을 사용하면 개별적으로 또는 그룹으로 시뮬레이션을 위한 피사체를 선택할 수 있다.

왼쪽 패널의 사용 가능한 목록에서 제목을 클릭하고 오른쪽 패널의 선택한 목록에 추가 버튼을 클릭하여 추가하십시오.

선택한 목록에서 제목을 제거하려면 오른쪽 패널에서 제목을 누른 다음 제거 단추를 누르십시오.

Add List and Remove List(목록 추가 및 목록 제거) 버튼을 사용하여 그룹 내에서 여러 과목(어린이, 청소년, 성인 또는 모든 과목)을 추가/제거하십시오.

추가/제거할 그룹에 해당하는 라디오 버튼을 선택하고 목록 추가 또는 목록 제거 버튼을 누르십시오.
카테고리를 선택하고 '목록 제거' 버튼을 클릭하여 전체 카테고리를 제거할 수도 있다.
특정 제목 이름 목록을 입력하려면 창에 쉼표로 구분된 이름을 입력하십시오.
그런 다음 쉼표로 구분된 제목 이름 입력 라디오 버튼을 선택하고 목록 추가 버튼을 클릭하십시오.


4. 결과: 결과 측정 및 그래픽 선택
T1DMS 시뮬레이터는 결과 측정값(시뮬레이션 결과에 따라 계산된 측정값)을 선택하고 그 결과를 그래픽 형식으로 표시하기 위한 여러 가지 옵션을 제공한다.
그래프는 일반적으로 전체 시뮬레이션에 대한 데이터를 포함하지만 결과 측정은 규제 기간 동안 데이터에 대해서만 계산된다는 점에 유의해야 한다.
혈당 추적에서, 규제 기간은 흑색에서 녹색으로 라인 색상의 변화로 표시된다.
선택한 결과 측정값 변경 버튼을 클릭하여 결과 측정값 및 그래프를 선택할 수 있다.
사용 가능한 옵션과 함께 Outcome Measures 창이 나타난다.

그림 5: 결과 측정 및 그래픽 선택

적절한 상자를 선택하여 원하는 결과 측정 및 그래프를 선택하십시오.
시뮬레이터에서 선택 항목을 활성화하려면 OK 버튼을 클릭하십시오.
OK를 클릭하기 전에 시뮬레이션을 실행하면, 시뮬레이터는 이전에 저장한 선택 항목을 기반으로 실행된다.
사용 가능한 결과 측정 및 그래프에 대한 자세한 내용은 부록 B: 결과 측정 및 결과 그래프를 참조하십시오.

4.1. 결과물
기본 선택은 가장 일반적으로 사용되는 결과 측정의 표준 세트를 나타낸다.
	*평균 BG(혈당)
	*목표값보다 낮은 비율
	*대상보다 높은 판독값 비율
	*대상 내 판독치 비율

기본 대상 혈당 범위는 70~180mg/dl이다. 원하는 상자를 클릭하고 값을 변경하여 목표 범위의 하한과 상한 값을 조정할 수 있다.

다음 결과 측정값 중에서 선택할 수도 있다:
	*평균 식사전 BG(혈당)
	*평균 식사 후 BG
	*판독값이 50mg/dl 미만인 비율
	*300mg/dl을 초과하는 판독값 비율
	*CHO 1g당 Post Prandial AUC - 탄수화물 1g당 곡선 부위(BG 농도)

4.2 그래프	
시뮬레이터는 시뮬레이션 결과를 표시하기 위해 다음과 같은 선택적 그림을 제공한다 : 
	*혈당 - BG(혈당) 그래프의 경우 시간 추적 및/또는 밀도 그림도 선택해야 함
	*위험 추적
	*집계 BG 추적
	*BG 변화율 히스토그램
	*Poincare 지점
	*변동성 제어 그리드 - CVGA 그래프의 경우 하루당(실행당 하루에 1점) 또는 주제당(실행당 1점) 중에서 			선택할 수 있다.

    그림 6: 혈당 및 제어 가변성 그리드 선택.

4.3. 변동성 & 위험성 과  등급 체계

변동성 및 위험성 및 등급 시스템에 대한 자세한 설명은 참조문서 6(섹션 10 참조)에서 확인할 수 있다.

4.4. 결과 측정 결과를 텍스트 파일로 저장
결과를 텍스트로 저장 확인란을 선택하면 결과 측정값이 결과 폴더의 .txt 파일에 저장된다.


기본 파일 이름은 "results_default.txt"이다. 텍스트 확인으로 저장 결과를 확인하면서 시뮬레이션을 실행할 때마다 시뮬레이터는 경고 없이 동일한 이름의 기존 파일을 덮어쓰게 된다.
시뮬레이션의 이전 결과 측정값을 손실하지 않으려면 저장하기 전에 'inter_filename' 창(그림 10 참조)에 고유한 파일 이름을 입력하십시오.


5. 하드웨어
하드웨어 섹션에서는 장치 프로파일에 내장된 여러 개의 하드웨어 파일 중에서 선택하거나 하드웨어 폴더에 저장된 하드웨어 파일 중에서 선택할 수 있다.

내장 장치를 사용하려면 내장 라디오 버튼을 클릭한 다음 원하는 포도당 센서를 클릭하고 펌프를 클릭하십시오.


그림 7: 기본 GUI의 하드웨어 옵션
하드웨어 파일에 설명된 하드웨어를 사용하려면 From Files: 라디오 버튼을 클릭한 다음 Select Hardware Files 버튼을 클릭하여 사용 가능한 센서 및 펌프 목록을 표시하십시오.

그림 8: 파일에서 하드웨어 선택
그런 다음 원하는 센서와 원하는 펌프를 클릭하여 선택하고 메인 윈도우로 돌아가기 버튼을 클릭하십시오.


그림 9: 펌프 및 센서 파일 선택


6. 사전 테스트/화면
사전 테스트/스크린 사용에 대한 설명은 섹션 9.3.2 메타볼릭 테스트를 참조하십시오.

7. 반복실험
시뮬레이션 실행 버튼 왼쪽에 있는 반복 옵션은 각 주제에 대해 지정된 횟수만큼 시뮬레이션을 반복한다.
반복 테스트 확인란을 클릭하고 원하는 반복 횟수를 입력하십시오.

당신은 또한 무작위 시드를 특정 숫자로 설정함으로써 정확한 실험 세트를 반복할 수 있다.
이렇게 하면 센서 소음을 시뮬레이션하는 데 사용되는 숫자의 순서가 고정되어 시뮬레이터 실행을 정확히 반복할 수 있다.


실험 대상의 수, 피험자의 순서, 반복 횟수, 시뮬레이션 길이가 모두 시뮬레이션 센서 노이즈를 계산하는 요인이라는 점에 유의한다.
따라서 센서 노이즈를 생성하는 숫자 시퀀스를 복제하려면 이러한 파라미터가 실행 간 동일해야 한다.
예를 들어, 대상 그룹에 대해 시뮬레이션을 실행한 다음 해당 그룹의 특정 주제에 대해 동일한 시뮬레이션을 실행한 경우, 결과는 해당 주제에 대해 동일하지 않을 것이다.
테스트를 반복하고 무작위 시드를 수정하여 동일한 결과를 얻으려면 동일한 순서대로 동일한 시간 동안 동일한 과목 그룹을 실행해야 한다.


8. 시뮬레이션 실행

Run Simulation(시뮬레이션 실행) 버튼을 클릭하면 선택한 시나리오에 따라 선택된 모든 피사체에 대한 계산이 시작된다.
시뮬레이션이 완료되면 시뮬레이터는 결과 측정과 그래프를 생성한다.


결과를 텍스트로 저장 확인란을 선택하면 결과 측정 텍스트 파일의 이름을 지정할 수 있는 프롬프트가 나타난다.
이 파일에는 각 주제와 실행(행)에 대해 선택된 모든 결과 측정값(열)이 포함되어 있다.

그림 10: 결과 측정 파일 이름 프롬프트
sim_results.mat 파일은 시뮬레이션의 원시 데이터를 포함하는 구조화된 데이터 파일이다.
시뮬레이션이 실행될 때마다 시뮬레이터는 동일한 이름의 기존 파일을 덮어쓰게 된다.




9. 시뮬레이터에 컨트롤러 포함
시뮬레이터에서 컨트롤러는 다음과 같은 두 가지 주요 구성요소의 조합이다 : 
선택된 제어법을 각 특정 주제(섹션 9.3)에 미세하게 조정하는 제어 설정 기능 파일(ctrlsetup.m)과 조정된 제어법(9.3)을 적용하는 시물링크 블록으로 구현된 런타임 알고리즘.

	9.1. SimulinkTM 블록에서 컨트롤러 구현
	제어법은 각 사용자에게 가능한 구현의 큰 선택을 제공하는 SimulinkTM 블록에서 실행되도록 구현되어야 		한다. 제어법 블록의 입력과 출력은 고정되어 있으며 아래에 기술되어 있다.
	
		9.1.1. 입력
		1. 포도당 측정값: 선택한 센서 측정값(mg/dl)
		참고: 판독값은 하드웨어 선택 시 선택한 센서에 따라 피하, IV 또는 SMBG일 수 있다.
		       센서 파라미터인 SensorType은 센서 유형을 지정한다.

		2. 인슐린 주사: pmol.min-1의 피하 인슐린 주사 (6000 pmol = 1 U)


		 3. 식사공고: 들어오는 식사의 양과 식사 시작 전후의 남은 시간(분)을 포함하는 벡터.
		   들어오는 식사가 60분 이상 앞서거나 60분 이상 지난 경우에는 두 값 모두 0이다.
		   이에 따라 식사시간 전후 60분 이상 식사공고가 없다.

		4. 토드: 하루 중 시간, 자정 5시 몇 분 후. 글루카곤 주사

		9.1.2. 출력
		1. 기초 펌프 속도: 펌프가 요청한 pmol.min-1의 기초 속도.

		2. Bolus pump rate: pmol.min-1의 bolus rate가 펌프를 요청함. 볼루스는 1분 이상 후에 구현할 		수 있다(예: 코즈모 펌프의 경우 최대 15개).

		3. IV 인슐린 주사: pmol.min-1의 IV 인슐린 주사 비율

		4. IV 덱스트로스 주사: IV 덱스트로스 주사 비율(mg/kg.min)

		5. 경구용 탄수화물: 조절기( 포도당 알약 등)가 주는 CHO의 gr.min-1.

		6. SQ 글루카곤

		참고: 펌프는 최소/최대 및 증분 측면에서 볼루스와 기본 속도를 다르게 처리한다.

		그림 11: 제어법 시뮬링크 블록

		그림 12: 제어법 구현의 예

	
	FDA 유효성 검사의 경우, 구조 변수 스트럿투라 또는 시나리오 또는 이 두 구조에서 파생된 변수를 참조하		지 않는 한 제어 블록에서 Simulink 블록, m-file 또는 S-기능을 사용할 수 있다.

	
	9.2. 시뮬레이션을 위해 컨트롤러 설정(변수 선택)

	특정 통제관은 표준 인슐린 섭식, 나이, 체중 또는 대사 테스트에서 추출한 일부 특성(예: IVGTT 또는 		HOMA에서 추출한 인슐린 민감도)에 기초하여 각 특정 주제에 대한 조정이 필요할 가능성이 있다.

	이를 위해 시뮬레이터는 각 실행 전에 컨트롤러를 조정할 수 있다.

	조정 절차는 '컨트롤러 설정' 폴더에 있는 ctrlsetup.m 파일에 캡슐화되어야 한다.

	ctrlsetup.m 파일은 주제별 변수를 정의할 수 있는 Matlab 함수 파일이어야 한다.

	그런 다음 이러한 변수는 시뮬레이션 중에 제어법 심뮬링크 블록에 사용할 수 있게 된다(시뮬레이터와 함		께 제공되는 '표준 처리' 제어법의 그린 블록 참조).

	참고: FDA 유효성 검사를 위해 제어 설정 기능은 스트럿투라 및 시나리오 구조 변수에 포함된 어떤 정보도 	사용해서는 안 된다.

	9.3. 시뮬레이터에 컨트롤러 블록 포함 시뮬레이터가 설치된 폴더에는 testing_platform.mdl이라는 파일이 		들어 있다.

	Matlab에서 이 파일을 열면 다음 Simulink 모델 창이 열린다.


	그림 13: 테스트 플랫폼

	하단의 오렌지 블록에는 콘트롤러가 들어 있다.

	섹션 9.1에서 구성한 대로 표준 처리 블록을 자신의 컨트롤러로 교체하고 Simulink 모델을 			test_platform.mdl로 저장하십시오.

	마지막 단계는 ctrlsetup.m 함수 파일과 기타 필요한 스크립트, 기능, m 파일, 매트 파일 및/또는 하위 기능		을 '컨트롤러 설정 폴더'에 복사하는 것이다.

	'컨트롤러 설정' 폴더 이외의 폴더(예를 들어 '컨트롤러 설정'에서 폴더를 만든 다음 해당 폴더에 파일을 넣		은 경우)에 추가된 스크립트나 하위 기능은 시뮬레이터에 표시되지 않으므로 사용되지 않는다는 점에 유의		해야 한다.

	참고: 컨트롤러를 변경한 후 Matlab을 재시작해야 하는 경우가 많다.




function ctrller=ctrlsetup(Quest,hd,sc,ctrller,struttura); 
ctrller.ctrlname='Testing_Std_Control'; % user-specified 
path_root=[cd '\controller setup']; 
addpath(path_root) 
%% Controller Dosing Algorithm Robustness Analysis Modifiers 
% % user can use these parameters explore & evaluate response to stress 
% NOT included in FDA master file % SImult will apply for the entire Tsimul 
ctrller.SImult=1; % modify SI, insulin sensitivity 
% Mealmult will apply for the entire Tsimul 
ctrller.Mealmult=1; % modify meal speed (<1=slower) 
% test with mis-announcement of the meals amount in the controller 
ctrller.meal_announce_modifier=[0 1]; % multiplicative time dependent modifier  
% modifier on meal_announce amount, set = 0 for no meal announcement  
% first column contains time from which to apply the values in the second column 
% ADD additive and/or multiplicative Bias to the CGM 
ctrller.CGM_bias=[0 0]; %additive time dependent modifier on CGM signal,  
% first column contains time from which to apply the values in the second column 
ctrller.CGM_bias_rel=[0 1]; %multiplicative time dependent modifier on CGM signal,  
% first column contains time from which to apply the values in the second column 
%% write your ctrlsetup code below 
ctrller.target=100; 
ctrller.thresh=150; 
ctrller.meal_time_diff=0; %plus/minus 60 max – see meal announce 
ctrller.basal=Quest.basal; 
ctrller.MD=Quest.MD; 
ctrller.CR=Quest.OB;
	
그림 14: 예제 ctrlsetup.m 파일



		9.3.1. 각 주제에 대한 사용 가능한 정보: 설문지

		ctrlsetup.m 기능을 실행할 때 사용자는 환자의 일부 특성에 액세스할 수 있다.

		이러한 특성은 임상 프로토콜 중 선별 방문의 사용을 모방하기 위해 쉽게 이용할 수 있다.

		따라서 그것들은 제한되며 구조 변수인 Quest에 포함된다. Quest 변수에는 다음 필드가 있다.

		1. 이름(연령 카테고리를 추출할 수 있는 위치:
		예: 사춘기#005)

		2. 체중, kg 단위 3. 단식BG, 기저 인슐린 주사에 따른 피험자의 금식 혈당, mg/dl 단위.


		4.기초, 즉 환자의 공복 시 글루코오스 레벨을 U/Hr로 유지하는 피험자의 인슐린 기초속도입니다
		면책사항: 요구된 기본 환율은 반드시 선택한 펌프로 구현할 수 있는 것은 아닙니다
		(예: 0.82U/hr는 0.8U/hr로 구현될것이다. 0.05U/hr의 증분을 갖는 Omnipod™를 인수하는데 사용			하는 경우 U/hr).
		이는 혈장 글루코오스, 특히 어린이 등 매우 민감한 환자에게 중대한 영향을 미칠 수 있습니다.

		5. OB는 탄수화물의 1그램 당 인슐린 단위로 최적의 보러스입니다.
		이것은 24시간 일반적인 날을 최적화하여 계산한다.
		각각 60g씩 60g씩 3개씩, 11pm 10g의 간식으로.
		각 식사는 CHO/OB의 g로 계산된 볼루스와 연관된다.
		사용된 최적화 기준은 위험 공간에서 포도당의 최소/최대 범위다.

		6. MD는 인슐린 1단위당 mg/dl의 최대강하량입니다.
		이것은 최대 감소로 계산된다.
		1 U 인슐린 
 후 포도당 농도(6시간 이상)
		

		7. TDI는 피험자 고유의 기본 레이트를 사용한 인슐린 단위로, 1일당 평균 인슐린 총량입니다.최			적의 보러스, 최대 드롭, 및 목표치는 120입니다.(최대 드롭은 보정계수 대리로 사용됩니다).


		9.3.2. 대사 시험

		시뮬레이터가 허용하는 가장 진보된 튜닝 절차 중 하나는 실제 실행 전에 대사 테스트를 시뮬레			이션할 수 있는 가능성이다.

		그렇게 하는 것은 꽤 간단하지만 가변적인 취급과 정의에 있어 큰 주의를 요한다.

		먼저 대사 테스트는 음식 섭취, IV 덱스트로스 주사, IV 인슐린 주사 또는 인슐린 피하 주사 등과 			관련된 모든 시나리오가 될 수 있다는 점에 유의해야 한다.

		시뮬레이션의 길이, 타이밍, 포도당 또는 인슐린 도전 횟수는 사용자의 상상력에 맡겨진다.

		이 때 시뮬레이터는 "개방 루프" 대사 테스트만 지원한다. 즉, 인슐린/덱스트로스/식료 치료는 테			스트 중에 적응하지 않고 테스트 전에 미리 결정된다.

		따라서 클램프 유형은 사용할 수 없다.

		대사 테스트를 실행하려면 먼저 주창 하단에 있는 대사 테스트 정의 버튼을 클릭하여 테스트에서 		사용할 수 있는 일련의 측정값(예: 혈장 포도당 또는 혈장 인슐린)을 정의해야 한다.

		그러면 다음 창이 활성화된다.


		그림 15: 대사 측정 선택

		측정을 선택한 후에는 타이밍 필드를 편집할 수 있다("글루코스" 또는 "인슐린과 동일"을 선택하			지 않은 경우).

		사용자는 예를 들어 Matlab에서 벡터 T를 정의하는 것처럼 측정 타이밍을 분 단위로 입력할 수 			있다. T=[1 2 3 4 5]와 T=[1:5] 또는 T=[0 1 2 3 4 10 15 20 25 30 60 90 120 150 180]과 T=[0:5 		10:5:30 60:30:180]과 동일하다. 측정 세트 생성을 클릭하여 창을 종료하고 선택 항목을 저장하십			시오.

		실제 대사 테스트를 실행하려면 ctrlsetup.m 함수에 다음 줄을 추가하십시오.



		[dataMetab]=run_metabolic_test(filename,struttura,scenario,hd,Quest) 	
		

		테스트 결과는 측정 유형별로 배열 요소가 하나씩 있는 구조 배열 데이터메타브와 필드 시간 및 			값이 있는 각 요소에 포함된다.

		측정은 dataMetab에서 항상 다음과 같은 순서로 이루어진다.

		혈장 인슐린 이전의 혈장 포도당, 피하 포도당 이전, 내생 포도당 생성 전, 혈당 주변 사용 전 혈			장 포도당 비율(RA)

		(컨트롤러 설정 폴더 및 시나리오 폴더에 예제 파일이 제공됨)


		참고: FDA 유효성 검사 연구의 경우 허용되는 유일한 대사 테스트는 IDE에 대해 제출된 임상 프			로토콜의 일부인 테스트, 혈액 그리기 포함, EGP, RA 및 활용도는 추적기를 사용하는 경우에만 				사용할 수 있다.


		10. 참고 및 확인 여기에서 언급된 T1DMS 타입 1 당뇨 대사 시뮬레이터는 UVa/Padova 타입 1 			당뇨 대사 시뮬레이터의 '분산 버전'이다.

		다음 참고문헌은 T1DMS의 개발을 기술하는 과학 문헌의 일부를 다룬다.


		
		10.1 참고자료

		1. 치아라 달라 맨, 로버트 A. 바이오메디컬 엔지니어링의 포도당-인슐린 시스템 IEEE 거래의 			Rizza 및 Claudio Cobeli Meal Simulation Model, 2007 54(10): 1740-1749

		2. 달라만 C, 카밀라리 M, 코벨리 C. 경구용 포도당 흡수 시스템 모델: 골드 표준 데이터에 대한 			검증. IEEE Trans 바이오메디컬 Eng. 2006 53(12): 2472-2478.

		3. 박사 마크 브레튼과 박사 보리스 코바체프 연속 포도당 센서의 정확도 분석, 모델링 및 시뮬레			이션 J 당뇨 공상 과학 기술 2008; 2(5): 853-862

		4. 보리스 P. 코바체프 박사, 마르크 D. 브레튼 박사, 치아라 달라 맨 박사, 클라우디오 코벨리 박			사. Silico 사전 임상시험에서 : 제1형 당뇨병의 폐쇄-루프 제어 개념 증명 J. 당뇨병 공상 과학 기			술 2009 3(1) : 44-45

		5. 스티븐 D. 파텍, 박사, 웨인 베켓, 박사, 마크 브레턴, 박사, 브루스 A. 버킹엄, 에얄 다소 박사, 			프란시스 J. 도일 3세 박사, 존 럼, 랄로 마그니 박사, 하워드 지서 박사, 실리코 프리클리닉 재판: 			제1형 당뇨병의 폐쇄 루프 제어 방법론 및 엔지니어링 가이드 2009 3(2): 269-282.

		6. 윌리엄 클라크, M.D.와 보리스 P. 코바체프 박사. 연속 포도당 모니터 데이터 분석을 위한 통계 		도구 2009 11(S1): S45-S54

		7. 랄로 마그니 박사, 다비드 M. 라이몬도, M.S, 치아라 달라 맨 박사, 마크 브레턴 박사, 스티븐 			파텍 박사, 기세페 드 니콜라오 박사, 클라우디오 코벨리 박사. 제어 변수 격자 분석을 통한 폐쇄 			루프 포도당 규제의 효과 평가 J. 당뇨병 2008 2(4): 630-635.

		8. 치아라 달라 만 박사, 프란체스코 미첼레토 박사, 다유 Lv 박사, 마크 브레턴 박사, 보리스 코바			체프 박사, 클라우디오 코벨리 박사. UVA/PADOVA 유형 1 당뇨 시뮬레이터: 새로운 특징 J. 당뇨			병 공상 과학 기술 2014 8(1): 26-34.

		9. 다유 Lv, 박사, 마크 D. 브레튼, 박사, 그리고 레온 S. 패리 박사님 제1형 당뇨병 멜리투스 환자 			당뇨병에서 외생성 글루카곤의 약동학 모델링 2013년 15월 11일: 935-941


		10.2 승인
		이 사용 설명서는 Marc D에 의해 작성되었다. 브레톤과 엡실론 그룹이 수정했다.



	부록 A: 샘플 시나리오.scn 및 ctrlsetup.m 파일
		
		A.1 주석이 달린 시나리오.scn

		
	주석이 달린 시나리오 파일

	참고: "*" 기본값을 나타냄

	참고: "%" 변수를 읽으려면 필요하지만, NOT => 주석

	파일 이름은 sim_results.mat data.scenario 파일로 제공됨

	TIME_of_Simulation_정보

	Tsimul 모델 실행 시간 – QTsimul 단위

	%Tsimul=1440

	QTsimul Tsimul Units – min*, hour, day

	%QTsimul=min

	sim 시작 시 simToD 시간(자정 후 분 단위) – 0*

	%simToD=0

	초기 혈당 값(mg/dl)

	BGinit이 지정되지 않음* =>대상 특정 단식 또는 mg/dl 단위로 지정

	이 예: %BGinit=[100]

	식사 정보 _ 총 또는 킬로그램 단위로 탄수화물, 식사 기간

	티말스
	시뮬레이션 시작 후 식사 시간 벡터

	%Tmeals=[8 12 19 23]

	QTMals Tmeals 유닛 – 최소*, 시간, 일

	%QTmeals

	식사_금액 VECTOR 일치_Tmeals_CHO(총 그램 또는 G/KG BW)

	%Ameals=[40 60 80 10]

	식사 지속시간_고정*분(15*) 또는 Tmeals와 일치하는 Dmeals VECTOR

	%Dmeals=[15]

	Qmeals는 Ameals Unit_total g cho 또는 g/kg 체중 =total* 또는 perkg이다.

	%Qmeals=total

	폐쇄 루프 처리 시작

	QT 폐쇄 장치의 SIM 시작 후 시간 - 최소*, 시간, 일

	%Tclosed=0 %QTclosed=hour

	시작 규정
	_시뮬레이션 시작 후 시간(분)

	REGURESS => 데이터는 결과 데이터의 분석 계산에 포함된다.

	내장 데이터 분석

	%Treg=0

	OPEN_LOOP 바살 주사

	기본 고정 _ "인슐린 한회분=[XX]" – 분당 인슐린 단위 설정

	Qbasal은 주제별 기준 비율(Quest override basal=)
	
	%Qbasal=quest


		A.2 주석이 달린 ctrlsetup.m

	
	


	부록 B: 결과 측정 및 결과 그래프

	
		B.1 결과 측정
	T1DM 시뮬레이터는 사용자가 선택하고 시뮬레이션 종료 시 계산한 "주체별" 포도당 제어 관련 분석을 생	성할 수 있다(계산 방법은 create_output.m 참조).

	모든 결과는 규정의 시작(Treg)과 시뮬레이션 종료 사이에 평가된다.


	평균 혈당 수치:
	실험 대상 포도당 측정값의 평균(mg/dl).

	식전 혈당 평균 값:
	식사 시간 전 시간 동안의 실험 대상당 평균 포도당 값(mg/dl).

	식후 혈당 평균 값:
	주어진 식사 후 60분 후에 시작하는 1시간 동안의 실험 대상당 평균 포도당 값(mg/dl).

	중증 저혈당(BG ≤ 50mg/dL):
	포도당 수준이 50 mg/dL 미만인 시간(대상당)의 백분율.

	저혈당(BG ≤ 70mg/dL)에서 백분율(사용자가 선택한 낮은 표적):
	포도당 수준이 70 mg/dL 미만인 시간(대상당)의 백분율.

	외유혈증(Low Target mg/dL < BG ≤ High Target mg/dL)에서의 백분율
	사용자가 지정한 목표 범위 내에서 포도당 레벨에 걸린 시간(대상당)의 백분율.

	고혈당(BG > High Target mg/dL)에서 백분율 시간(사용자 선택 높은 목표):
	포도당 수준이 180mg/dL보다 큰 시간(대상당)의 백분율.

	심각한 고혈당(BG > 300mg/dL)에서 백분율:
	포도당 수치가 300 mg/dL보다 큰 시간(대상당)의 백분율.

	Post Prandial AUC(CHO 1g당):
	곡선 아래의 프랜디얼 영역(> 식전 BG)을 모든 식사에 걸쳐 소비된 탄수화물의 총 그램으로 나눈 값(규정 	중).
	평균[ (BG- 식전 평균 BG)]/gCHO.

	낮은 BGI(Low BG Index):
	LBGI는 낮은 BG 판독값의 빈도와 범위에 대한 측정값이다. LBGI는 저혈당증에 대한 장기적 위험의 자세한 	분석을 제공한다.
	이러한 위험 값은 최소(LBGI [1.1]), 낮음(1.1㎛ LBGI < 2.5), 보통(2.5㎛ LBGI < 5), 고위험군(LBGI) 5.0을 식	별하는 데 사용할 수 있다.

	높은 BG 지수(HBGI):
	HBGI는 높은 BG 판독값의 빈도와 범위를 측정하는 것이다.
	HBGI는 고혈당 장기 위험의 피실험적인 분석을 제공한다.
	이러한 위험 값은 최소(HBGI<5.0), 낮음(5.0㎛ HBGI < 10.0), 보통(10.0㎛ HBGI < 15), 고위험군(HBGI) 15.0	을 식별하는 데 사용할 수 있다.


	BG 위험 지수(BGRI):
	BG 위험 지수는 단순히 HBGI 및 LBGI 값의 대상별 합이다.
	BGRI는 극단적인 포도당 제어 관련 이벤트를 발생하기 쉬운 개별 피험자를 식별하기 위한 지표를 제공한다	.

	SD의 BG 변화율:
	BG 변화율은 시뮬레이션 실행 중 15분 간격 동안 포도당 판독값의 비율로 계산된다.
	이러한 값의 표준 편차는 모델 내에서 폐쇄 루프 제어의 안정성을 측정하기 위해 계산된다.




		B.1 결과 그래프

	분산 T1DMS는 다음과 같은 포도당 제어 관련 그래프를 생성한다.

	혈당(추적) - 인구/주체:
	혈당 추적 그래프는 실험 시간에 대한 대상별 또는 모집단별 BG 추적을 제공한다.
	BG 값은 규정 전 검은색 선으로, 규정 중 녹색 선으로 표시된다.

	혈당(밀도) - 인구/주체:
	혈당 밀도 그래프는 포도당 값의 확률 분포를 제공한다.
	그래프는 시뮬레이션의 목표 범위를 기준으로 세 개의 섹션으로 나뉜다.
	각 목표 영역 내에서 포도당 판독값의 계산된 확률을 숫자로 표시한다.

	위험 추적 - 모집단/제목:
	포도당 위험 추적 그래프는 (규정 기간 동안) 시뮬레이션의 각 시간(LBGI, < 0으로 표시됨)과 HBGI(< 0으로 	표시됨)의 변동을 표시한다.
	이 그래프는 시뮬레이션 내내 혈당 내 임계 분산을 강조하기 위해 큰 편차를 강조하고 목표 범위 내에서의 	변동을 억제한다.

	집계된 BG 추적 - 제목: 집계 포도당 추적은 당질 조절의 임상 영역에 대한 시간당 그래픽 디스플레이를 제	공한다.

	BG 변화율 히스토그램 - 모집단/주체:
	포도당 변화율 히스토그램은 조절 중 다양한 혈당 변화율(분당 mg/dL 단위)의 빈도와 분포를 나타낸다.

	푸앵카레 그림 - 제목:
	푸앵카레 그림은 주어진 피험자의 포도당 안정성에 대한 그래픽 요약을 제공한다.
	값들의 더 작고 더 집중된 집합은 높은 포도당 안정성을 나타내는 반면, 널리 분산된 영역은 BG 관련 불규	칙성(즉, 빈번하고 극단적인 포도당 배출)을 나타낸다.

	관리 변동성 그리드 분석(일별/대상별) - 모집단/대상:
	CVGA(Control Variability Grid Analysis) 지점은 대상별 포도당 극단값을 나타낸다.
	개별 점들은 다음과 같이 계산된다: 각 주제에 대해 점들은 각각 주어진 관찰 기간 동안 최소 및 최대 BG 	값에 동일한 x-좌표와 y-좌표로 표시된다. 참고: 센서 오류를 기각하기 위해 x 및 y 값의 신뢰 한계를 전체 	BG 분포의 95% 산포도로 설정했다.














